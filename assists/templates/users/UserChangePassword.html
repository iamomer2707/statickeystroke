{% extends 'users/userbase.html' %}
{% load static %}
{% block contents %}

<div class="col-sm-6 wow fadeInRight">
    <h3 class="column-title">User Change Password</h3>
    <h4 style="color:white">Hello :  {{ request.session.loginid }}</h4>
    <h4 style="color:RED">{{ msg }}</h4>

    <form action="{% url 'UserChangePassword' %}" method="POST" style="width: 100%; padding: 0; background-color: transparent;">
        {% csrf_token %}

        <!-- Current Password Field -->
        <div class="form-group" style="margin-bottom: 20px;">
            <label for="cpassword" style="color: #ffffff; font-weight: bold; display: block;">Current Password</label>
            <input type="password" name="cpassword" id="cpassword" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" required class="form-control">
        </div>

        <!-- New Password Field -->
        <div class="form-group" style="margin-bottom: 20px;">
            <label for="npassword" style="color: #ffffff; font-weight: bold; display: block;">New Password</label>
            <input type="password" name="npassword" id="npassword" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" required class="form-control">
        </div>

        <!-- Hidden Fields for Keystroke Data -->
        <input type="hidden" name="cskda" id="cid_skda">
        <input type="hidden" name="nskda" id="nid_skda">

        <!-- Submit Button -->
        <button id="done" class="btn btn-primary btn-block" type="submit" style="padding: 10px 15px; font-size: 16px; margin-top: 20px;">Change Password</button>

    </form>

    <script>
        var doneButton = document.getElementById('done');
        var pswdField = document.getElementById('cpassword');
        var lengthOfEmail = 0;
        var time_start = 0;
        var time_end = 0;

        pswdField.onkeyup = function () {
            lengthOfEmail++;
            if (lengthOfEmail == 1) time_start = new Date();
            else time_end = new Date().getTime() - time_start;
        };

        var pswdField1 = document.getElementById('npassword');
        var lengthOfEmail1 = 0;
        var time_start1 = 0;
        var time_end1 = 0;

        pswdField1.onkeyup = function () {
            lengthOfEmail1++;
            if (lengthOfEmail1 == 1) time_start1 = new Date();
            else time_end1 = new Date().getTime() - time_start1;
        };

        doneButton.onclick = function () {
            document.getElementById("cid_skda").value = time_end;
            document.getElementById("nid_skda").value = time_end1;
        };

        const signalKeypressDuration = (key, duration) => {
            console.log(`Key ${key} pressed for ${duration} ms`);
        };

        const keys = {};
        document.body.addEventListener("keydown", ({ key }) => {
            if (!keys[key]) keys[key] = Date.now();
        });
        document.body.addEventListener("keyup", ({ key }) => {
            signalKeypressDuration(key, Date.now() - keys[key]);
            keys[key] = null;
        });
    </script>

</div>

{% endblock %}
